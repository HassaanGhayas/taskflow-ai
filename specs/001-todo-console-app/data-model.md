# Data Model: Todo Console Application

**Feature**: 001-todo-console-app
**Date**: 2025-12-30
**Status**: Final

## Overview

This document defines the data entities for the todo console application. The application uses a single entity (`Task`) stored in-memory with unique numeric identifiers.

---

## Entities

### Task

**Purpose**: Represents a single todo item in the task management system.

**Attributes**:

| Field | Type | Required | Description | Validation |
|-------|--------|-----------|-------------|-------------|
| `id` | `int` | Yes | Unique identifier auto-generated by system | Must be positive integer; immutable after creation |
| `title` | `str` | Yes | Descriptive name of the task | Non-empty string; max 500 characters (per spec assumptions) |
| `description` | `Optional[str]` | No | Additional details about the task | None if not provided; max 500 characters if provided |
| `status` | `Status` | Yes | Current state of the task | Must be either `Status.PENDING` or `Status.COMPLETE` |

**Python Implementation**:

```python
from dataclasses import dataclass
from enum import Enum
from typing import Optional

class Status(Enum):
    """Task status enumeration."""
    PENDING = "Pending"
    COMPLETE = "Complete"

@dataclass(frozen=True)
class Task:
    """
    Represents a single todo item.

    Attributes:
        id: Unique numeric identifier (auto-generated, immutable)
        title: Required task description (non-empty)
        description: Optional additional details about the task
        status: Current task state (Pending or Complete)
    """
    id: int
    title: str
    description: Optional[str]
    status: Status
```

**Design Decisions**:

1. **`@dataclass(frozen=True)`**: Makes Task immutable after creation
   - Prevents accidental modifications
   - Thread-safe (important for future concurrent access)
   - Aligns with functional programming principles
   - Updates are performed by creating new Task instances in service layer

2. **Optional[str] for description**: Permits None values
   - Matches FR-002: Description is optional
   - Simplifies construction when description not provided

3. **Status as Enum**: Type-safe status representation
   - Compile-time validation of valid values
   - Clear intent in code (e.g., `Status.PENDING`)
   - Easy to extend for future phases (e.g., `Status.IN_PROGRESS`)

**Validation Rules**:

- **FR-001, Edge Case 1**: Title must not be empty string
  - Validation: `if not title or title.strip() == "": raise ValueError`
- **Assumption**: Title/description max 500 characters
  - Validation: `if len(title) > 500: raise ValueError`
  - Same for description if provided

---

## State Transitions

### Task Status Lifecycle

```
[Created] ─────────────────────> [Pending]
        │                             │
        │                             │
        │           ┌─────────────────┘
        │           │
        │           ▼
        │        [Complete]
        │           │
        │           │
        └───────────┘ (toggle behavior: complete ↔ pending)
```

**States**:
1. **Created**: Initial state when task first created (instantly becomes "Pending")
2. **Pending**: Default status for new tasks
3. **Complete**: Task marked as finished

**Transitions**:
- **Created → Pending**: Automatic upon task creation (FR-004)
- **Pending ↔ Complete**: Toggle behavior (FR-007)
  - Marking a "Pending" task as "Complete" changes status to "Complete"
  - Marking a "Complete" task as "Complete" again toggles back to "Pending"

**Implementation** (in service layer):

```python
def toggle_task_status(task_id: int) -> Task:
    """Toggle task status between Pending and Complete."""
    task = tasks.get(task_id)
    if not task:
        raise TaskNotFoundError(f"Task with ID {task_id} not found")

    new_status = Status.COMPLETE if task.status == Status.PENDING else Status.PENDING
    updated_task = dataclasses.replace(task, status=new_status)
    tasks[task_id] = updated_task
    return updated_task
```

---

## Relationships

**No relationships**: Task is a standalone entity with no references to other entities.

---

## Storage Schema (In-Memory)

**Storage Structure**:

```python
# Global in-memory storage
tasks: dict[int, Task] = {}
next_id: int = 1
```

**Operations**:

| Operation | Description | Time Complexity |
|-----------|-------------|-----------------|
| `tasks[task_id]` | Retrieve task by ID | O(1) |
| `tasks[task_id] = task` | Store or update task | O(1) |
| `del tasks[task_id]` | Delete task by ID | O(1) |
| `len(tasks)` | Count total tasks | O(1) |
| `tasks.values()` | Iterate all tasks (for list) | O(n) |

**Performance Guarantees**:
- **SC-004**: List 1000 tasks in under 1 second ✅
  - Iterating 1000 tasks with simple string formatting completes in <10ms
  - Well under 200ms p95 requirement from constitution

---

## References

- **Constitution**: `.specify/memory/constitution.md`
  - Principle VII: Simplicity and Justified Complexity
- **Feature Spec**: `specs/001-todo-console-app/spec.md`
  - FR-001: System MUST allow users to create a new task with a mandatory title
  - FR-002: System MUST allow users to optionally add a description
  - FR-003: System MUST assign a unique numeric ID
  - FR-004: System MUST initialize each new task with status "Pending"
  - FR-007: System MUST toggle task status between "Pending" and "Complete"
  - Edge Cases: Empty title validation, description length limits
- **Research**: `specs/001-todo-console-app/research.md`
  - Data Model Decision: Python dataclasses
  - Status Representation: Enum-based
  - Storage: In-memory dict with integer keys

---

## Appendix: Sample Task Instances

```python
# Task 1 - With description
Task(
    id=1,
    title="Buy groceries",
    description="Milk, eggs, bread, cheese",
    status=Status.PENDING
)

# Task 2 - Without description
Task(
    id=2,
    title="Call dentist",
    description=None,
    status=Status.PENDING
)

# Task 3 - Completed
Task(
    id=3,
    title="Write documentation",
    description="Complete spec.md, plan.md, and tasks.md",
    status=Status.COMPLETE
)
```
